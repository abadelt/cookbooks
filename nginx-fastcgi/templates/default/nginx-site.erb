<%- @servers.each do |s| %>
server {

        <%- if  s[:ip].nil? %>
        listen <%= s[:port] %>;
        <%- else %>
        listen <%= "#{s[:ip]}:#{s[:port]}" %>;
        <%- end %>
        
        server_name  <%= s[:server_name] %> <%= s[:server_alias].join(' ') %>;
        <%- if s[:ssl] == true %>
            include <%= s[:ssl_include_path] %>;
        <%- end %>
        expires <%= @expires %>;

        location / {
            include fastcgi_params;
        <%- if s[:ssl_on] == true %>
            fastcgi_param  HTTPS on;
        <%- end %>
            # We also set some headers to prevent proxies
            add_header Pragma "no-cache";
            add_header Cache-control "no-cache, must-revalidate, private, no-store";
            expires -1s;

            access_log /var/log/nginx/<%= @site_name %>.access.log;
            error_log  /var/log/nginx/<%= @site_name %>.error.log;
        }
}
<%- end %>

